
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PeerDrop â€” Auto Join</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(to right, #0f172a, #1e293b);
      color: #f1f5f9;
    }
    .glass {
      background: rgba(255, 255, 255, 0.04);
      border: 1px solid rgba(255, 255, 255, 0.06);
      backdrop-filter: blur(14px);
    }
    .btn {
      background: rgba(255,255,255,0.07);
      transition: all 0.2s ease-in-out;
    }
    .btn:hover {
      background: rgba(255,255,255,0.15);
    }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center px-4 py-8">
  <div class="glass rounded-xl shadow-xl w-full max-w-xl p-6 space-y-6 text-center">
    <h1 class="text-3xl font-bold text-white">PeerDrop</h1>
    <p class="text-sm text-gray-400">P2P File Sharing with QR Join Links</p>

    <div id="roleUI" class="flex flex-col gap-4">
      <button onclick="startSend()" class="btn rounded-lg px-4 py-2 w-full text-white">ðŸ“¤ Send</button>
      <button onclick="startReceive()" class="btn rounded-lg px-4 py-2 w-full text-white">ðŸ“¥ Receive</button>
    </div>

    <div id="sendUI" class="hidden space-y-4">
      <p class="text-sm text-gray-300">Scan or share this link</p>
      <a id="roomLink" href="#" target="_blank" class="text-blue-400 underline break-all text-sm"></a>
      <div class="flex justify-center">
        <div id="qrcode" class="my-2"></div>
      </div>
      <p class="text-xs text-gray-400">Waiting for peer to connect...</p>
      <button onclick="leaveRoom()" class="btn text-sm mt-2">Leave Room</button>
    </div>

    <div id="receiveUI" class="hidden space-y-3">
      <input id="roomInput" placeholder="Enter Room Code" class="w-full px-4 py-2 rounded text-black" />
      <button onclick="joinRoom()" class="btn w-full rounded-lg px-4 py-2 text-white">ðŸ”— Join</button>
      <button onclick="leaveRoom()" class="btn text-sm mt-2">Back</button>
    </div>
  </div>

<script>
let socket, pc, channel;
let roomCode = "", isInitiator = false;
const $ = id => document.getElementById(id);

function startSend() {
  isInitiator = true;
  roomCode = Math.random().toString(36).substring(2, 8).toUpperCase();
  const roomUrl = window.location.origin + "/#" + roomCode;
  $("roomLink").textContent = roomUrl;
  $("roomLink").href = roomUrl;
  $("qrcode").innerHTML = "";
  new QRCode("qrcode", { text: roomUrl, width: 160, height: 160 });
  show("sendUI");
  connect();
}

function startReceive() {
  show("receiveUI");
}

function joinRoom() {
  roomCode = $("roomInput").value.trim().toUpperCase();
  if (roomCode) {
    isInitiator = false;
    connect();
  }
}

function leaveRoom() {
  if (pc) pc.close();
  if (socket) socket.close();
  show("roleUI");
}

function show(id) {
  ["roleUI", "sendUI", "receiveUI"].forEach(x => $(x).classList.add("hidden"));
  $(id).classList.remove("hidden");
}

function connect() {
  socket = new WebSocket("wss://webrtc-node-0s89.onrender.com");
  socket.onopen = () => {
    socket.send(JSON.stringify({ type: "join", room: roomCode }));
  };
}

window.onload = () => {
  const hash = window.location.hash;
  if (hash && hash.length > 1) {
    roomCode = hash.substring(1).toUpperCase();
    isInitiator = false;
    connect();
    show("receiveUI");
    $("roomInput").value = roomCode;
  }
};
</script>
</body>
</html>
